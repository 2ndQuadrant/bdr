SELECT * FROM bdr_regress_variables()
\gset
\c :node1_dsn
SELECT pglogical.replicate_ddl_command($DDL$
CREATE TABLE public.demo(
    id integer primary key
);
$DDL$, ARRAY['bdrgroup']);
 replicate_ddl_command 
-----------------------
 t
(1 row)

-- TODO: This should happen automatically with BDR, adding tables to
-- the default repset on creation.
SELECT bdr.replication_set_add_table('demo');
 replication_set_add_table 
---------------------------
 
(1 row)

SELECT nspname, relname FROM pglogical.tables WHERE set_name = 'bdrgroup';
 nspname | relname 
---------+---------
 public  | demo
(1 row)

INSERT INTO demo(id) VALUES (42);
\c :node2_dsn
SELECT pglogical.wait_slot_confirm_lsn(NULL, NULL);
 wait_slot_confirm_lsn 
-----------------------
 
(1 row)

-- TODO: This should happen automatically with BDR
SELECT bdr.replication_set_add_table('demo');
 replication_set_add_table 
---------------------------
 
(1 row)

SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'demo';
 table_name 
------------
 demo
(1 row)

SELECT nspname, relname FROM pglogical.tables WHERE set_name = 'bdrgroup';
 nspname | relname 
---------+---------
 public  | demo
(1 row)

SELECT id FROM demo ORDER BY id;
 id 
----
 42
(1 row)

INSERT INTO demo(id) VALUES (43);
\c :node1_dsn
SELECT pglogical.wait_slot_confirm_lsn(NULL, NULL);
 wait_slot_confirm_lsn 
-----------------------
 
(1 row)

SELECT id FROM demo ORDER BY id;
 id 
----
 42
 43
(2 rows)

