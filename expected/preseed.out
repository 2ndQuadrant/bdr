/*
 * Tests to ensure that objects/data that exists pre-clone is successfully
 * cloned. The results are checked, after the clone, in preseed_check.sql.
 */
-- Unfortunately the cloned DB currently isn't the same between bdr and udr
SELECT current_setting('bdrtest.origdb') AS origdb
\gset
\c :origdb
DO $DO$BEGIN
IF bdr.bdr_variant() = 'BDR' THEN
    SET default_sequenceam = local;
END IF;
END; $DO$;
CREATE SEQUENCE some_local_seq;
CREATE TABLE some_local_tbl(id serial primary key, key text unique not null, data text);
INSERT INTO some_local_tbl(key, data) VALUES('key1', 'data1');
INSERT INTO some_local_tbl(key, data) VALUES('key2', NULL);
INSERT INTO some_local_tbl(key, data) VALUES('key3', 'data3');
-- At this time we create the truncation trigger even though BDR
-- hasn't been activated yet.
\d+ some_local_tbl
                                             Table "public.some_local_tbl"
 Column |  Type   |                          Modifiers                          | Storage  | Stats target | Description 
--------+---------+-------------------------------------------------------------+----------+--------------+-------------
 id     | integer | not null default nextval('some_local_tbl_id_seq'::regclass) | plain    |              | 
 key    | text    | not null                                                    | extended |              | 
 data   | text    |                                                             | extended |              | 
Indexes:
    "some_local_tbl_pkey" PRIMARY KEY, btree (id)
    "some_local_tbl_key_key" UNIQUE CONSTRAINT, btree (key)
Triggers:
    truncate_trigger AFTER TRUNCATE ON some_local_tbl FOR EACH STATEMENT EXECUTE PROCEDURE bdr.queue_truncate()

