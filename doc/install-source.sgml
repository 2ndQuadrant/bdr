<chapter id="installation-source">
 <title>Installing &bdr; or &udr; from source</title>

 <sect1>
  <title>Prerequisites for installing from source</title>
  <para>
   To install either &bdr; or &udr; the prerequisites for compiling
   &postgres; must be installed. These are described in &postgres;'s
   documentation
   on <ulink url='http://www.postgresql.org/docs/current/install-requirements.html'>build requirements</ulink>
   and <ulink url='http://www.postgresql.org/docs/current/docguide-toolsets.html'>build requirements for documentation</ulink>.
  </para>

  <para>
   On several systems the prerequisites for compiling &postgres; and
   &bdr;/&udr; can be installed using simple commands.

   <itemizedlist spacing="compact" mark="bullet">
    <listitem>
     <para>
      <literal>Debian</literal> and <literal>Ubuntu</literal>: First
      add the <ulink
      url="http://apt.postgresql.org/">apt.postgresql.org</ulink>
      repository to your <filename>sources.list</filename> if you
      have not already done so. Then install the pre-requisites for
      building PostgreSQL with:
      <programlisting>
       sudo apt-get update
       sudo apt-get build-dep postgresql-9.4
      </programlisting>
      </para>
    </listitem>
    <listitem>
     <para>
      <literal>RHEL or CentOS 6.x or 7.x</literal>: install the appropriate repository RPM
      for your system from <ulink url="http://yum.postgresql.org/repopackages.php">
      yum.postgresql.org</ulink>. Then install the prerequisites for building
      PostgreSQL with:
      <programlisting>
       sudo yum check-update
       sudo yum groupinstall "Development Tools"
       sudo yum install yum-utils openjade docbook-dtds docbook-style-dsssl docbook-style-xsl
       sudo yum-builddep postgresql94
      </programlisting>
     </para>
    </listitem>

   </itemizedlist>
  </para>
 </sect1>

 <sect1 id="installation-bdr-source">
  <title>Installation of &bdr; from source</title>
  <para>
   Installing &bdr; from source consists out of two steps: First
   compile and install &postgres; with the &bdr; additions; secondly
   compile and install the &bdr; plugin.
  </para>

  <para>
   The patched PostgreSQL required for BDR can be compiled using the
   <ulink
   url="http://www.postgresql.org/docs/current/static/installation.html">normal
   documented procedures</ulink>. That will usually be something
   like:
   <programlisting>
    cd /path/to/bdr-pg-source/
    ./configure --prefix=/path/to/install --enable-debug --enable-openssl
    make -j4 -s install-world
   </programlisting>
  </para>
  <para>
   To then install &bdr; execute its configure script with the
   <application>pg_config</application> installed by the patched PostgreSQL
   in the <literal>PATH</literal> environment variable, e.g.:
   <programlisting>
    cd /path/to/bdr-plugin-source/
    PATH=/path/to/install:"$PATH" ./configure
    make -j4 -s all
   </programlisting>
  </para>
 </sect1>

 <sect1 id="installation-udr-source">
  <title>Installation of &udr; from source</title>
  <para>
   Installing &udr; is simpler than installing &bdr;. It compiles
   against a stock (unmodified) &postgres; 9.4 if the relevant
   headers are installed.
  </para>

  <para>
   Most Linux distributions put the required header files in a "dev"
   or "devel" package. Exactly what to install depends on how you
   installed PostgreSQL in the first place.
   <itemizedlist>
    <listitem>
     <para>
      If you installed from apt.postgresql.org packages on
      Debian/Ubuntu then run:
      <programlisting>
       sudo apt-get install postgresql-server-dev-9.4
      </programlisting>
     </para>
    </listitem>
    <listitem>
     <para>
      If you installed from yum.postgresql.org packages on
      RHEL or CentOS then run:
      <programlisting>
       sudo yum install postgresql94-dev
      </programlisting>
     </para>
    </listitem>
   </itemizedlist>
  </para>

  <para>
   To compile &udr; execute its configure script with &postgres;'s
   <application>pg_config</application> in the <literal>PATH</literal>.
   <programlisting>
    cd /path/to/bdr-plugin-source/
    PATH=/path/to/pg/install:"$PATH" ./configure
    make -j16 -s all
   </programlisting>
   On Debian/Ubuntu systems <application>pg_config</application> is on the default
   <literal>PATH</literal> so you can just run
   <programlisting>
    ./configure
   </programlisting>
   On RHEL/CentOS systems you will need to put
   <filename>/usr/pgsql-9.4/bin</filename> on the
   <literal>PATH</literal>, e.g.:
   <programlisting>
    PATH=/usr/pgsql-9.4/bin:$PATH ./configure
   </programlisting>
  </para>
 </sect1>

</chapter>
